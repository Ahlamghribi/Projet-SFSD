#include <stdio.h>
#include <stdbool.h>
#include <string.h>

typedef struct {
    int jour, mois, annee;
} date;

typedef struct {
    char nom[20];
    int qte;
    float prix;
    int reference;
    char ingredient[30];
    struct date datefabr, dateexp;

} Medicament;

typedef struct {
    char tab[500];
    int nb;
} Bloc;

typedef struct {
    int nbrenrg, nbbloc;
} entete;


int main() {
    FILE *fichier = fopen("medicaments.dat", "rb+");
    Entete entete;
    entete.nbrenrg = 0;
    entete.nbbloc = 0;

    Bloc bloc;
    bloc.nb = 0;

    int choix;

    do {
        printf("\n=======================================\n");
        printf("            GESTION DES MEDICAMENTS\n");
        printf("=======================================\n");
        printf("1. Ajouter un medicament\n");
        printf("2. Rechercher un medicament\n");
        printf("3. Supprimer un medicament\n");
        printf("4. Quitter\n");
        printf("=======================================\n");
        printf("Choix: ");
        scanf("%d", &choix);

        switch (choix) {
            case 1: {
                // Ajouter un médicament
                Medicament nouveauMed = creerMedicament();
                if (ajouterAuBloc(&bloc, nouveauMed)) {
                    entete.nbrenrg++;
                    enregistrerBloc(fichier, bloc, &entete);
                    printf("\nMedicament ajoute avec succes.\n");
                } else {
                    // Si le médicament ne peut pas être ajouté au bloc actuel, créer un nouveau bloc
                    enregistrerBloc(fichier, bloc, &entete);
                    bloc.nb = 0;
                    ajouterAuBloc(&bloc, nouveauMed);
                    entete.nbrenrg++;
                    enregistrerBloc(fichier, bloc, &entete);
                    printf("\nMedicament ajoute avec succes.\n");
                }
                break;
            }
            case 2: {
                // Rechercher un médicament par référence
                int reference;
                printf("\nEntrez la reference du medicament: ");
                scanf("%d", &reference);

                Medicament resultat = rechercherMedicament(fichier, reference);

                if (strlen(resultat.nom) > 0) {
                    printf("\nMedicament trouve :\n");
                    afficherMedicament(resultat);
                } else {
                    printf("\nMedicament non trouve.\n");
                }
                break;
            }
            case 3: {
                // Supprimer un médicament par référence
                int reference;
                printf("\nEntrez la reference du medicament a supprimer: ");
                scanf("%d", &reference);

                if (supprimerMedicament(fichier, reference)) {
                    printf("\nMedicament supprime avec succes.\n");
                } else {
                    printf("\nMedicament non trouve.\n");
                }
                break;
            }
            case 4:
                printf("\nProgramme termine.\n");
                break;
            default:
                printf("\nChoix invalide. Veuillez reessayer.\n");
                break;
        }
    } while (choix != 4);

    fclose(fichier);

    return 0;
}

 
